<!DOCTYPE html>
<html>

<head>
    <title>PodChat Browser Version</title>
    <link href="https://talk.pod.ir/styles/images/_common/favicon-32x32.png" rel="icon" type="image/x-icon"/>

    <!-- Development Mode -->
    <script type="text/javascript" src="../src/utility/utility.js"></script>
    <script type="text/javascript" src="../node_modules/podasync-ws-only/src/utility/utility.js"></script>
    <script type="text/javascript" src="../node_modules/podasync-ws-only/src/network/socket.js"></script>
    <script type="text/javascript" src="../node_modules/podasync-ws-only/src/network/async.js"></script>
    <script type="text/javascript" src="../node_modules/crypto-js/crypto-js.js"></script>
    <script type="text/javascript" src="../node_modules/dexie/dist/dexie.min.js"></script>
    <script type="text/javascript" src="../bower_components/kurento-utils/js/kurento-utils.min.js"></script>
    <script type="text/javascript" src="../bower_components/webrtc-adapter/release/adapter.js"></script>
    <script type="text/javascript" src="../src/chat.js"></script>

    <!-- Production Mode -->
    <!--<script type="text/javascript" src="podchat.js"></script>-->
    <!--<script type="text/javascript" src="podchat-browser.min.js"></script>-->

    <script type="text/javascript">
        // Developement
        var PodChat = window.POD.Chat;

        // Production
        //        var PodChat = window.PodChat;

        var params = {
            appId: new Date().getTime(),

            /**
             * ActiveMQ Config
             */
            // protocol: "queue",
            // queueHost: "10.56.16.25",
            // queuePort: "61613",
            // queueUsername: "root",
            // queuePassword: "zalzalak",
            // queueReceive: "queue-in-amjadi-stomp",
            // queueSend: "queue-out-amjadi-stomp",
            // queueConnectionTimeout: 20000,
            // serverName: "chat-server",

            /**
             * Main Server
             */
            // socketAddress: 'wss://msg.pod.ir/ws', // {**REQUIRED**} Socket Address
            // ssoHost: 'https://accounts.pod.ir', // {**REQUIRED**} Socket Address
            // platformHost: 'https://api.pod.ir/srv/core', // {**REQUIRED**} Platform Core Address
            // fileServer: 'https://core.pod.ir', // {**REQUIRED**} File Server Address
            // podSpaceFileServer: 'https://podspace.pod.ir', // {**REQUIRED**} File Server Address
            // serverName: 'chat-server', // {**REQUIRED**} Server to to register on

            /**
             * Sand Box
             */
            socketAddress: "wss://chat-sandbox.pod.ir/ws",
            ssoHost: "https://accounts.pod.ir",
            platformHost: "https://sandbox.pod.ir:8043/srv/basic-platform",
            fileServer: 'https://core.pod.ir',
            podSpaceFileServer: 'https://podspace.pod.ir',
            serverName: "chat-server",

            /**
             * Integration
             */
            // socketAddress: "ws://172.16.110.235:8003/ws",
            // ssoHost: "http://172.16.110.76",
            // platformHost: "http://172.16.110.235:8003/srv/bptest-core",
            // fileServer: 'https://core.pod.ir',
            // podSpaceFileServer: 'http://172.16.110.61:8780/podspace',
            // serverName: "chatlocal",

            grantDeviceIdFromSSO: false,
            enableCache: false, // Enable Client side caching
            fullResponseObject: true,
            mapApiKey: '8b77db18704aa646ee5aaea13e7370f4f88b9e8c',
            // typeCode: "talk",
            token: "bb84fe08b8ce4c329bd65a34b06ee9be",
            // token: "3dd6895c8dc64f93bcd43b58dcc2aab3", // Masoud Amjadi
            // token: "9c627a9125d04ebf8455bf57bb33d2a9", // Pooria Pahlevani
            // token: "f6464d4e0f044314b1a668f90287ba26", // Nadia Anvari
            // token: "99506f7c32c849a9a6e2a954303b81ee", // Farhad Kheirkhah
            // token: "979aa5de03934c73a5c6c855bd80cb04", // Mahyar Zhiani
            // token: "a47c9016c8354236abc01395093bed5c", // Ahmad Sajadi
            // token: "d3114ed2fd2a49b4a0a386e727c9e5fa", // Saba Safavi
            // token: "872110b9c6944eda9bc98ef2a68dcf50", // Leila Nemati
            wsConnectionWaitTime: 500, // Time out to wait for socket to get ready after open
            connectionRetryInterval: 5000, // Time interval to retry registering device or registering server
            connectionCheckTimeout: 10000, // Socket connection live time on server
            messageTtl: 24 * 60 * 60, // Message time to live (1 day in seonds)
            reconnectOnClose: true, // auto connect to socket after socket close
            httpRequestTimeout: 30000,
            httpUploadRequestTimeout: 0, // 0 means No timeout
            forceWaitQueueInMemory: true,
            // asyncRequestTimeout: 500,
            asyncLogging: {
                onFunction: true, // log main actions on console
                consoleLogging: true, // log action results in console
                //     onMessageReceive: true, // log received messages on console
                //     onMessageSend: true, // log sent messaged on console
                //     actualTiming: true // log actual functions running time
            }
        };

        var chatAgent = new PodChat(params),
            PID,
            P2P_THREAD_ID = 293,
            callWebSocket,
            webpeers = {};

        var chatReadyInstance = chatAgent.on("chatReady", function () {
            // chatAgent.sendLocationPing({
            //     location: 'contacts'
            // }, function(res) {
            //     console.log('Loation Ping has been sent', res);
            // });

            // chatAgent.terminateCall({
            //     callId: 234
            // }, function(res){
            //     console.log({res})
            // })

            // chatAgent.startCall({
            //     threadId: 4441,
            //     type: 'voice',
            //     // invitees: [
            //     //     {
            //     //         idType: 'TO_BE_USER_CONTACT_ID',
            //     //         id: 934363
            //     //     }
            //     // ]
            // }, function(result) {
            //     console.log({result});
            //
            //     // chatAgent.cancelCall({callId: event.result.callId}, function (res) {
            //     //     console.log({res});
            //     // });
            // });

            // chatAgent.getCallsList({
            //     // type: 'video'
            //     // callIds: [273, 274]
            //     name: 'فرهاد'
            // }, function(calls){
            //     console.log({calls});
            // });

            // chatAgent.getContacts(
            //     {
            //         query: 'poori'
            //     }, function(res) {
            //         console.log({res})
            //     }
            // )
            // chatAgent.pinMessage({
            //     messageId: 601414,
            //     notifyAll: true
            // }, function(res){
            //     console.log({res});
            // });
            /*******************************************************
             *                       U S E R                       *
             *******************************************************/
            // console.log('sending seen');
            // chatAgent.seen({
            //     messageId: 109291,
            //     ownerId: 254
            // })

            // chatAgent.getCurrentUserRoles({
            //     threadId: 35316
            // }, function(result) {
            //     console.log(result);
            // });

            // var currentUser = chatAgent.getCurrentUser();
            // console.log(currentUser)

            // chatAgent.getAllUnreadMessagesCount({}, function(result){
            //     console.log('All unread messages count is: ', result);
            // });

            /**
             *  Get User Info
             */
            // getUserInfo();

            // chatAgent.updateChatProfile({
            //     bio: 'Whatever :|',
            //     metadata: {
            //         birthDate: '26 Jun 1991',
            //         constellation: 'cancer ♋'
            //     }
            // }, function(result) {
            //     console.log(result)
            // });

            // chatAgent.getUserNotSeenDuration({
            //     userIds: [164055, 366174]
            // }, function(result) {
            //     console.log(result);
            // });

            // chatAgent.startTyping({
            //     threadId: 13554
            // });
            //
            // setTimeout(function () {
            //     chatAgent.stopTyping();
            // }, 15000);

            /*******************************************************
             *                    T H R E A D S                    *
             *******************************************************/

            /**
             * GET THREADS
             * @param count
             * @param offset
             * @param threadIds
             * @param name
             */
            // getThreads({
            //     count: 50,
            //     offset: 0,
            //     // threadIds: [312, 1210],
            //     threadName: "فرهاد"
            // });


            /**
             * CREATE THREAD (Creates Group)
             * @param invitees
             * @param threadType
             */
            // createThread([{
            //     "id": 934363,
            //     "type": "TO_BE_USER_CONTACT_ID"
            // }, {
            //     "id": 3459620,
            //     "type": "TO_BE_USER_CONTACT_ID"
            // }], "NORMAL");

            /**
             * CREATE THREAD (Creates P2P Chat with a specific user)
             * @param contactId
             */
            // createThread({id: 121, type: "TO_BE_USER_ID"});

            /**
             * GET THREAD PARTICIPANTS
             * @param threadId
             */
            // getThreadParticipants(293);

            /**
             * ADD PARTICIPANTS
             * @param threadId
             * @param contacts {Array}  CONTACT ID
             */
            // addParticipants(8088, 'contact', [7741]);
            // addParticipants(36038, 'username', ['poddraw']);
            // addParticipants(7548, 'coreuserid', [919]); //15508?

            /**
             * REMOVE PARTICIPANTS
             * @param threadId
             * @param participants {Array}  USER ID
             */
            // removeParticipants(3, [4]);

            /**
             * LEAVE THREAD
             * @param threadId
             */
            // leaveThread(3);

            /**
             * GET THREAD HISTORY
             * @param count
             * @param offset
             * @param threadId
             * @param firstMessageId
             * @param lastMessageId
             * @param metaQuery
             * @param query
             */
            // getHistory({
            //     count: 50,
            //     offset: 0,
            //     threadId: 149486,
            //     fromTimeFull: 1611728867161577000,
            //     order: 'asc',
            //     // firstMessageId: 17035,
            //     // order: "ASC",
            //     // lastMessageId: 17052,
            //     // metadataCriteria: {
            //     //   "field": "type",
            //     //   "has": "BOT_",
            //     //   "and": [{
            //     //     "field": "id",
            //     //     "is": "1534835339446"
            //     //   }]
            //     // },
            //     query: "کِیفین",
            //     // messageType: 'sticker'
            // });

            /**
             * GET SINGLE MESSAGE
             * @param threadId
             * @param messageId
             */
            // getSingleMessage(293, 13698);

            /**
             * MUTE THREAD
             * @param threadId
             */
            // muteThread(3);

            /**
             * UNMUTE THREAD
             * @param threadId
             */
            // unMuteThread(3);

            /**
             * UPDATE THREAD INFO
             * @param threadId
             */
            // TODO: Check the image property
            // chatAgent.updateThreadInfo({
            //   threadId: 51163,
            //   image: JSON.stringify({
            //       fileHash: "16e37b412fe-0.9111035145050199",
            //       link: "https://core.pod.ir/nzh/image?imageId=333415&hashCode=16e37b412fe-0.9111035145050199"
            //   }),
            //   description: "توضیحات ترد جدید",
            //   title: "عنوان ترد",
            //   metadata: {
            //     id: 1152,
            //     owner: "masoudmanson",
            //     name: "John Doe"
            //   }
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * SPAM P2P THREAD
             * @param threadId
             */
            // chatAgent.spamPvThread({
            //   threadId: 1020
            // }, function(result) {
            //   console.log(result);
            // });

            /*******************************************************
             *                   C O N T A C T S                   *
             *******************************************************/

            /**
             * GET CONTACTS
             */
            // getContacts({
            //     // contactId: "7741",
            //     // cellphoneNumber: "912",
            //     // email: "gmail.com",
            //     // query: "بهنام",
            //     // uniqueId: "672803e8-455f-4201-b0d6-64216b19679a"
            // });

            /**
             * BLOCK CONTACT
             * @param contactId
             */
            // blockContact(3459620);

            /**
             * GET BLOCKED CONTACTS LIST
             * @param count
             * @param offset
             */
            // getBlockedList();

            /**
             * UNBLOCK CONTACT
             * @param blockId
             */
            // unblockContact(23602);

            /**
             * ADD CONTACTS
             * @param firstName
             * @param lastName
             * @param cellphoneNumber
             * @param email
             */
            // var addContactInstantResult = chatAgent.addContacts({
            //   firstName: "حامد",
            //   lastName: "مهرآرا",
            //   cellphoneNumber: "09188644304",
            //   email: "hamed.m844a@gmail.com"
            // }, function(result) {
            //   console.log(result);
            // });
            /**
             * UPDATE CONTACTS
             * @param id
             * @param firstName
             * @param lastName
             * @param cellphoneNumber
             * @param email
             */
            // chatAgent.updateContacts({
            //     id: "716",
            //     firstName: "حامد",
            //     lastName: "مهرآرا",
            //     cellphoneNumber: "09122903204",
            //     email: "h.mehrara@fanap.ir"
            // }, function (result) {
            //     console.log(result.result);
            // });

            /**
             * REMOVE CONTACTS
             * @param id
             */
            // chatAgent.removeContacts({
            //   id: 7742
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * SEARCH CONTACTS
             * @link http://sandbox.pod.land:8080/apidocs/swagger-ui.html?srv=/nzh/listContacts
             */
            // chatAgent.searchContacts({
            //     // cellphoneNumber: "0912", // LIKE
            //     // id: 563, // EXACT
            //     // firstName: "Hamid", // LIKE
            //     // lastName: "ra", // LIKE
            //     // email: "m", // LIKE
            //     // uniqueId: "f10c94f7-3013-4e34-9b3e-6a3bd25ce2a6", // EXACT
            //     // q: "v" // LIKE in firstName, lastName, email
            // }, function (result) {
            //     if (!result.hasError) {
            //         console.log(result);
            //     }
            // });

            /*******************************************************
             *                   M E S S A G E S                   *
             *******************************************************/

            /**
             * SEND MESSAGE IN THREAD
             * @param threadId
             * @param newMessage
             * @param metadata
             */
            // setInterval(function() {
            //     sendMessage(4441, "PooPoo This is a Sample Message at " + new Date(), {
            //         id: new Date().getTime(),
            //         type: "BOT_MESSAGE",
            //         owner: "Masoud"
            //     });
            // }, 1000);

            /**
             * SEND FILE MESSAGE IN THREAD
             * @param threadId
             * @param file
             * @param caption
             * @param metadata
             */
            // sendFileMessageUsecase(15, __dirname + "/test/image.jpg", "Sample file description", {
            //   custom_name: "John Doe"
            // });

            /**
             * SEND BOT MESSAGE IN THREAD
             * @param messageId
             * @param receiverId
             * @param newMessage
             */
            // sendBotMessage(14954, 121, {
            //   command: "reverse",
            //   lat: "35.7003510",
            //   lng: "51.3376472"
            // });

            /**
             * EDIT MESSAGE IN THREAD
             * @param messageId  325 editable: false
             * @param newMessage
             */
            // editMessage(919202, "New message content goes here.");

            /**
             * DELETE MESSAGE IN THREAD
             * @param {int}      messageId
             * @param {boolean}  deleteForAll
             */
            // deleteMessage(919192, true);

            /**
             * REPLY TO MESSAGE
             * @param threadId
             * @param messageId
             */
            // replyMessage(8543, 881920, "Reply to message.");

            /**
             * FORWARD MESSAGE
             * @param destination
             * @param messageIds
             */
            // forwardMessage(57583, [592482, 592481]);

            /**
             * GET MESSAGE SEEN LIST
             * @param messageId
             */
            // chatAgent.getMessageSeenList({
            //   messageId: 19623
            // }, function(seenList) {
            //   console.log("Seen list", seenList);
            // });

            /**
             * GET MESSAGE DELIVERED LIST
             * @param messageId
             */
            // chatAgent.getMessageDeliveredList({
            //   messageId: 19623
            // }, function(seenList) {
            //   console.log("Delivery list", seenList);
            // });

            /*******************************************************
             *               F I L E   U P L O A D S               *
             *******************************************************/

            /**
             * UPLOAD IMAGE
             * @param  {string}  image     Image path
             * @param  {int}     xC        Crop start x coordinates
             * @param  {int}     yC        Crop start y coordinates
             * @param  {int}     hC        Crop height
             * @param  {int}     wC        Crop width
             */
            // uploadImage(__dirname + "/test/test.jpeg", 0, 0, 400, 400);

            /**
             * GET IMAGE
             * @param  {int}     imageId     Image ID
             * @param  {string}  hashCode    Hash Code
             */
            // getImage(2531, '1649d4e932a-0.8852815409984853');

            /**
             * UPLOAD FILE
             * @param  {string}  file     File path
             */
            // uploadFile(__dirname + "/test/test.txt");

            /**
             * GET FILE
             * @param  {int}     fileId          Image ID
             * @param  {string}  hashCode        Hash Code
             * @param  {boolean} downloadable    Downloadable link or not?
             */
            // getFile(344, '196CHI61NUROW8S1', true);

            /*******************************************************
             *                 N E S H A N   M A P                 *
             *******************************************************/

            /**
             * Get Address of a GeoLocation point
             *
             * @param  {float}   lat     Latitute of the Location
             * @param  {float}   lng     Longtitute of the Location
             */
            // chatAgent.mapReverse({
            //   lat: 35.7003508,
            //   lng: 51.3376460
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * Get nearby places names as "term" keyword
             * around the given GeoLocation
             *
             * @param  {float}   lat     Latitute of the Location
             * @param  {float}   lng     Longtitute of the Location
             * @param  {string}  term    Search term to be searched
             */
            // chatAgent.mapSearch({
            //   lat: 35.7003508,
            //   lng: 51.3376460,
            //   term: "فروشگاه"
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * Get routing between two given GeoLocations
             *
             * @param  {object}   origin         Lat & Lng of Origin as a JSON
             * @param  {object}   destination    Lat & Lng of Destination as a JSON
             * @param  {boolean}  alternative    Give Alternative Routs too
             */
            // chatAgent.mapRouting({
            //   origin: {
            //     lat: 35.7003508,
            //     lng: 51.3376460
            //   },
            //   destination: {
            //     lat: 35.7343510,
            //     lng: 50.3376472
            //   },
            //   alternative: true
            // }, function(result) {
            //   console.log(result);
            // });

            /**
             * Get Static Image of a GeoLocation
             *
             * @param  {string}   type           Map style (default standard-night)
             * @param  {int}      zoom           Map zoom (default 15)
             * @param  {object}   center         Lat & Lng of Map center as a JSON
             * @param  {int}      width          width of image in pixels (default 800px)
             * @param  {int}      height         height of image in pixels (default 600px)
             */
            // chatAgent.mapStaticImage({
            //   type: "standard-night",
            //   zoom: 15,
            //   center: {
            //     lat: 35.7003508,
            //     lng: 51.3376462
            //   },
            //   width: 800,
            //   height: 500
            // }, function(result) {
            //   console.log(result);
            // });

            // var sendLocationMessageInstantResponse = chatAgent.sendLocationMessage({
            //     mapType: "standard-night",
            //     mapZoom: 16,
            //     mapCenter: {
            //         lat: 35.73229,
            //         lng: 51.90794
            //     },
            //     mapWidth: 1200,
            //     mapHeight: 500,
            //     threadId: 148737,
            //     userGroupHash: 'A6ULVAUYM1E1G9',
            //     systemMetadata: {
            //         time: new Date()
            //     }
            // }, function(result) {
            //     console.log(result);
            // });
            //
            // setTimeout(function() {
            //     sendLocationMessageInstantResponse.cancel();
            // }, 1000);


            /*
             * Create Bot
             */
            // chatAgent.createBot({
            //     botName: 'docsBOT'
            // }, (result) => {
            //     console.log(result);
            // });

            /*
             * Define Bot Commands
             */
            // chatAgent.defineBotCommand({
            //     botName: 'metalBOT',
            //     commandList: ['start']//'hola', 'adios', 'gracias', 'denada']
            // }, function(result) {
            //     console.log('Define Bot Command result', result);
            // });

            // chatAgent.getThreadParticipants({
            //     threadId: 42076
            // }, function(result) {
            //     console.log(result);
            // });

            // addParticipants(8543, 'username', ['docsBOT']);

            /*
             * Start Bot
             */
            // chatAgent.startBot({
            //     botName: 'docsBOT',
            //     threadId: 8543
            // }, (result) => {
            //     console.log(result);
            // });

            /*
             * Stop Bot
             */
            // chatAgent.stopBot({
            //     botName: 'yoBOT',
            //     threadId: 7411
            // }, (result) => {
            //     console.log('Stop Bot result', result);
            // });

            // chatAgent.getBotCommandsList({
            //     botName: 'docsBOT'
            // }, function(result) {
            //     console.log(result);
            // });

            // chatAgent.getThreadAllBots({threadId: 8543}, function (result) {
            //     console.log(result);
            // })
        });

        /**
         * Listen to Error Messages
         */
        chatAgent.on("error", function (error) {
            console.log("Error ", error);
        });

        /**
         * Listen to Chat State Changes
         */
        chatAgent.on("chatState", function (chatState) {
            // console.log(chatState);
        });

        /**
         * Listen to File Upload Events
         */
        chatAgent.on("fileUploadEvents", function (event) {
            console.log(event);
        });

        chatAgent.on("contactEvents", function (event) {
            if (event.type == 'CONTACTS_SYNCED') {
                console.log('Core contacts have been successfully synced with chat server.');
            }
        });

        /**
         * Listen to Thread Events
         */
        chatAgent.on("threadEvents", function (event) {
            var type = event.type;
            console.log(event);

            switch (type) {
                case "THREAD_LAST_ACTIVITY_TIME":
                    break;

                case "THREAD_NEW":

                    break;

                case "THREAD_ADD_PARTICIPANTS":
                    break;

                case "THREAD_REMOVE_PARTICIPANTS":
                    break;

                case "THREAD_LEAVE_PARTICIPANT":
                    break;

                case "THREAD_REMOVED_FROM":
                    break;

                case "THREAD_RENAME":
                    break;

                case "THREAD_MUTE":
                    break;

                case "THREAD_UNMUTE":
                    break;

                case "THREAD_INFO_UPDATED":
                    break;

                case "THREAD_UNREAD_COUNT_UPDATED":
                    break;

                default:
                    break;
            }
        });

        /**
         * Listen to Message Events
         */
        var chatOnMessageEventsObject = chatAgent.on("messageEvents", function (event) {
            var type = event.type,
                message = event.result.message;

            console.log(event);

            switch (type) {
                case "MESSAGE_NEW":
                    /**
                     * Sending Message Seen to Sender after 5 secs
                     */
                    // console.log('Sending Message Deliver');
                    // chatAgent.deliver({
                    //     messageId: message.id,
                    //     threadId: message.threadId
                    // });
                    // console.log('Sending Message Seen');
                    // chatAgent.seen({
                    //     messageId: message.id,
                    //     threadId: message.threadId
                    // });

                    break;

                case "MESSAGE_EDIT":
                    break;

                case "MESSAGE_DELIVERY":
                    break;

                case "MESSAGE_SEEN":
                    break;

                case "MESSAGE_FAILED":
                    break;

                default:
                    break;
            }
        });

        /**
         * Listen to System Events
         */
        chatAgent.on("systemEvents", function (event) {
            var type = event.type;
            console.log(event);

            switch (type) {
                case "IS_TYPING":
                    // console.log(event.result.user.user + " is typing in thread #" + event.result.thread);
                    break;

                default:
                    break;
            }
        });

        /**
         * Listen to User Events
         */
        chatAgent.on('userEvents', function (event) {
            var type = event.type;
            console.log(event);

            switch (type) {
                case 'CHAT_PROFILE_UPDATED':
                    console.log('Chat Profile Has Been Updated', event);
                    break;

                default:
                    break;
            }
        });

        /**
         * Listen to Call Events
         */
        chatAgent.on('callEvents', function (event) {
            var type = event.type;
            console.log(event);

            switch (type) {
                case 'RECEIVE_CALL':

                    console.log('Accepting the call #' + event.result.callId);
                    chatAgent.acceptCall({
                        callId: event.result.callId
                    }, function (res) {
                        console.log({res});
                    });

                    // console.log('Rejecting the call #' + event.result.callId);
                    // chatAgent.rejectCall({
                    //     callId: event.result.callId
                    // }, function (res) {
                    //     console.log({res});
                    // });

                    // console.log('End the call #' + event.result.callId);
                    // chatAgent.endCall({
                    //     callId: event.result.callId
                    // }, function (res) {
                    //     console.log({res});
                    // });

                    break;

                case 'CALL_SESSION_CREATED':
                    document.getElementById('call-receive-id').innerText = event.result.callId;
                    break;

                case 'CALL_STARTED':
                    document.getElementById('call-receive-broker').innerText = event.result.clientDTO.brokerAddress.split(',')[0];
                    document.getElementById('call-receive-send').innerText = event.result.clientDTO.topicSend;
                    document.getElementById('call-receive-receive').innerText = event.result.clientDTO.topicReceive;
                    document.getElementById('call-receive-key').innerText = event.result.clientDTO.sendKey;

                    uiCallStart({
                        uiLocalVideo: 'uiLocalVideo',
                        uiRemoteVideo: 'uiRemoteVideo',
                        sendingTopic: event.result.clientDTO.topicSend,
                        receiveTopic: event.result.clientDTO.topicReceive,
                        brokerAddress: event.result.clientDTO.brokerAddress.split(',')[0]
                    });
                    break;

                default:
                    break;
            }
        });


        /**
         * Local Functions
         */

        function uiCallStart(params) {
            callWebSocket = new WebSocket('wss://46.32.6.187/gsthandler');
            turnIp = "46.32.6.188";

            uiLocalVideo = document.getElementById(params.uiLocalVideo);
            uiRemoteVideo = document.getElementById(params.uiRemoteVideo);
            sendingTopic = params.sendingTopic;
            receiveTopic = params.receiveTopic;

            callWebSocket.onopen = function () {
                sendCallSocketMessage({
                    id: 'CREATE_SESSION',
                    brokerAddress: '10.56.16.51:9093',//params.brokerAddress,
                    clientId: 'token'
                });


                console.log("[start] Create WebRtcPeerSendrecv");

                const sendoptions = {
                    localVideo: uiLocalVideo,
                    mediaConstraints: {
                        audio: false,
                        video: {
                            width: 176,
                            height: 144,
                        }
                    },
                    onicecandidate: (candidate) => {
                        sendCallSocketMessage({
                            id: 'ADD_ICE_CANDIDATE',
                            topic: sendingTopic,
                            candidate: candidate,
                            transferType: 2
                        })
                    },
                    configuration: {
                        iceServers: [
                            {"urls": "stun:" + turnIp + ":3478"},
                            {
                                "urls": "turn:" + turnIp + ":3478",
                                "username": "mkhorrami",
                                "credential": "mkh_123456"
                            }
                        ]
                    }
                };

                const reciveoptions = {
                    remoteVideo: uiRemoteVideo,
                    mediaConstraints: {audio: false, video: true},
                    onicecandidate: (candidate) => {
                        sendCallSocketMessage({
                            id: 'ADD_ICE_CANDIDATE',
                            topic: receiveTopic,
                            candidate: candidate,
                            transferType: 2
                        })
                    },
                    configuration: {
                        iceServers: [
                            {"urls": "stun:" + turnIp + ":3478"},
                            {
                                "urls": "turn:" + turnIp + ":3478",
                                "username": "mkhorrami",
                                "credential": "mkh_123456"
                            }
                        ]
                    }
                };

                webRtcPeer2 = new kurentoUtils.WebRtcPeer.WebRtcPeerRecvonly(reciveoptions,
                    function (err) {
                        if (err) {
                            console.error("[start/WebRtcPeerRecvonly] Error in constructor: "
                                + explainUserMediaError(err));
                            return;
                        }

                        console.log("[start/WebRtcPeerRecvonly] Created; generate SDP Offer");

                        webRtcPeer2.generateOffer((err, sdpOffer) => {
                            if (err) {
                                console.error("[start/WebRtcPeerRecvonly/generateOffer] " + err);
                                return;
                            }
                            sendCallSocketMessage({
                                id: 'RECIVE_SDP_OFFER',
                                sdpOffer: sdpOffer,
                                useComedia: true,
                                useSrtp: false,
                                topic: receiveTopic,
                                mediaType: 2
                            });

                            console.log("[start/WebRtcPeerRecvonly/generateOffer] Done!");
                        });
                    });
                webpeers[receiveTopic] = webRtcPeer2;

                webRtcPeer = new kurentoUtils.WebRtcPeer.WebRtcPeerSendonly(sendoptions,
                    function (err) {
                        if (err) {
                            sendCallSocketError("[start/WebRtcPeerSendrecv] Error: " + explainUserMediaError(err));
                            stop();
                            return;
                        }

                        console.log("[start/WebRtcPeerSendrecv] Created; start local video");
                        startVideo(uiLocalVideo);

                        console.log("[start/WebRtcPeerSendrecv] Generate SDP Offer");
                        webRtcPeer.generateOffer((err, sdpOffer) => {
                            if (err) {
                                sendCallSocketError("[start/WebRtcPeerSendrecv/generateOffer] Error: " + err);
                                stop();
                                return;
                            }
                            sendCallSocketMessage({
                                id: 'SEND_SDP_OFFER',
                                topic: sendingTopic,
                                sdpOffer: sdpOffer,
                                mediaType: 2
                            });

                            console.log("[start/WebRtcPeerSendrecv/generateOffer] Done!");
                        });
                    });
                webpeers[sendingTopic] = webRtcPeer;
                console.log("[start] Create WebRtcPeerRecvonly");
            };

            callWebSocket.onmessage = function (message) {
                const jsonMessage = JSON.parse(message.data);
                console.log("[onmessage] Received message: " + message.data);

                switch (jsonMessage.id) {
                    case 'PROCESS_SDP_ANSWER':
                        console.log('******************************');
                        handleProcessSdpAnswer(jsonMessage);
                        break;
                    case 'ADD_ICE_CANDIDATE':
                        handleAddIceCandidate(jsonMessage);
                        break;
                    case 'GET_KEY_FRAME':
                        setTimeout(restartVideo, 8000);
                        break;
                    case 'ERROR':
                        handleError(jsonMessage, sendingTopic, receiveTopic);
                        break;
                    default:
                        console.warn("[onmessage] Invalid message, id: " + jsonMessage.id);
                        break;
                }
            }
        }

        function sendCallSocketMessage(message) {
            if (callWebSocket.readyState !== callWebSocket.OPEN) {
                console.warn("[sendMessage] Skip, WebSocket session isn't open");
                return;
            }

            const jsonMessage = JSON.stringify(message);
            console.log("[sendMessage] message: " + jsonMessage);
            callWebSocket.send(jsonMessage);
        }

        function sendCallSocketError(message) {
            console.error(message);

            sendCallSocketMessage({
                id: 'ERROR',
                message: message,
            });
        }

        function explainUserMediaError(err) {
            console.log({err})
            const n = err.name;
            if (n === 'NotFoundError' || n === 'DevicesNotFoundError') {
                return "Missing webcam for required tracks";
            } else if (n === 'NotReadableError' || n === 'TrackStartError') {
                return "Webcam is already in use";
            } else if (n === 'OverconstrainedError' || n === 'ConstraintNotSatisfiedError') {
                return "Webcam doesn't provide required tracks";
            } else if (n === 'NotAllowedError' || n === 'PermissionDeniedError') {
                return "Webcam permission has been denied by the user";
            } else if (n === 'TypeError') {
                return "No media tracks have been requested";
            } else {
                return "Unknown error: " + err;
            }
        }

        function startVideo(video) {
            video.play().catch((err) => {
                if (err.name === 'NotAllowedError') {
                    console.error("[start] Browser doesn't allow playing video: " + err);
                } else {
                    console.error("[start] Error in video.play(): " + err);
                }
            });
        }

        function restartVideo() {
            uiLocalVideo.pause();
            webRtcPeer.getLocalStream().getTracks()[0].enabled = false;
            webRtcPeer.getLocalStream().getTracks()[0].applyConstraints({width: 160});

            setTimeout(function () {
                webRtcPeer.getLocalStream().getTracks()[0].applyConstraints({width: 176});
                webRtcPeer.getLocalStream().getTracks()[0].enabled = true;
                uiLocalVideo.play()
            }, 1000);
        }

        function handleProcessSdpAnswer(jsonMessage) {
            console.log("[handleProcessSdpAnswer] SDP Answer from Kurento, process in WebRTC Peer");

            let sampleWebRtc = webpeers[jsonMessage.topic];
            if (sampleWebRtc == null) {
                console.warn("[handleProcessSdpAnswer] Skip, no WebRTC Peer");
                return;
            }

            sampleWebRtc.processAnswer(jsonMessage.sdpAnswer, (err) => {
                if (err) {
                    sendCallSocketError("[handleProcessSdpAnswer] Error: " + err);
                    stop();
                    return;
                }

                console.log("[handleProcessSdpAnswer] SDP Answer ready; start remote video");
                startVideo(uiRemoteVideo);
            });
        }

        function handleAddIceCandidate(jsonMessage) {
            let sampleWebRtc = webpeers[jsonMessage.topic];
            if (sampleWebRtc == null) {
                console.warn("[handleAddIceCandidate] Skip, no WebRTC Peer");
                return;
            }

            sampleWebRtc.addIceCandidate(jsonMessage.candidate, (err) => {
                if (err) {
                    console.error("[handleAddIceCandidate] " + err);
                    return;
                }
            });
        }

        function handleError(jsonMessage, sendingTopic, receiveTopic) {
            const errMessage = jsonMessage.message;
            console.error("Kurento error: " + errMessage);

            console.log("Assume that the other side stops after an error...");
            callStop(sendingTopic, receiveTopic);
        }

        function callStop(sendingTopic, receiveTopic) {

            console.log("[stop]");

            if (webRtcPeer) {
                webRtcPeer.dispose();
                webRtcPeer = null;
            }

            if (webRtcPeer2) {
                webRtcPeer2.dispose();
                webRtcPeer2 = null;
            }

            sendCallSocketMessage({
                id: 'STOP',
                topic: sendingTopic
            });

            sendCallSocketMessage({
                id: 'STOP',
                topic: receiveTopic
            });
        }

        function getUserInfo() {
            chatAgent.getUserInfo(function (userInfo) {
                console.log(userInfo);
            });
        }

        function getThreads(params) {
            var instantResult = chatAgent.getThreads(params, function (threadsResult) {
                console.log(threadsResult);
            });
            // console.log(instantResult);
        }

        function getThreadParticipants(threadId) {
            var getParticipantsParams = {
                count: 50,
                offset: 0,
                threadId: threadId,
                // name: "مهیار"
            };

            chatAgent.getThreadParticipants(getParticipantsParams, function (participantsResult) {
                if (!participantsResult.hasError) {
                    console.log(participantsResult);
                }
            });
        }

        function addParticipants(threadId, type, participants) {
            switch (type) {
                case 'contact':
                    chatAgent.addParticipants({
                        threadId: threadId,
                        contacts: participants
                    }, function (result) {
                        console.log(result);
                    });
                    break;

                case 'username':
                    chatAgent.addParticipants({
                        threadId: threadId,
                        usernames: participants
                    }, function (result) {
                        console.log(result);
                    });
                    break;

                case 'coreUserids':
                    chatAgent.addParticipants({
                        threadId: threadId,
                        coreUserids: participants
                    }, function (result) {
                        console.log(result);
                    });
                    break;
            }
        }

        function removeParticipants(threadId, participants) {
            chatAgent.removeParticipants({
                threadId: threadId,
                participants: participants
            }, function (result) {
                // console.log(result);
            });

        }

        function leaveThread(threadId) {
            chatAgent.leaveThread({
                threadId: threadId
            }, function (result) {
                // console.log(result);
            });
        }

        function getContacts(params) {
            chatAgent.getContacts(params, function (contactsResult) {
                if (!contactsResult.hasError) {
                    console.log(contactsResult);
                }
            });
        }

        function getSingleMessage(threadId, messageId) {
            chatAgent.getHistory({
                offset: 0,
                threadId: threadId,
                id: messageId
            }, function (historyResult) {
                if (!historyResult.hasError) {
                    console.log(historyResult.result.history);
                }
            });
        }

        function getHistory(params) {

            var startTime = new Date().getTime();

            params.queues = {
                sending: true,
                uploading: true,
                failed: true
            };

            chatAgent.getHistory(params, function (historyResult) {
                if (!historyResult.hasError) {
                    console.log(historyResult);
                    var endTime = new Date().getTime();
                    console.log(`Get History Duration: ${endTime - startTime} ms`);
                }
            });
        }

        function sendMessage(threadId, message, metadata) {
            sendChatParams = {
                threadId: threadId,
                textMessage: message,
                messageType: 0,
                systemMetadata: metadata
            };

            var sentMesageUniqueId = chatAgent.sendTextMessage(sendChatParams, {
                onSent: function (result) {
                    console.log(result.uniqueId + ' \t has been Sent!');
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + ' \t has been Delivered!');
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + ' \t has been Seen!');
                }
            });
        }

        function sendFileMessageUsecase(threadId, file, caption, metadata) {
            var instantResult = chatAgent.sendFileMessage({
                threadId: threadId,
                file: file,
                content: caption,
                systemMetadata: metadata
            }, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                },
                onFileUpload: function (result) {
                    console.log('File Upload is done', result);
                }
            });

            console.log("\nInstant Result For sendFileMessage:\n", instantResult);
        }

        function sendBotMessage(messageId, receiverId, message, metadata) {
            sendChatParams = {
                messageId: messageId,
                content: message,
                receiver: receiverId,
                systemMetadata: metadata
            };

            var mim = chatAgent.sendBotMessage(sendChatParams, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                }
            });

            console.log(mim);
        }

        function editMessage(messageId, newMessage) {
            editChatParams = {
                messageId: messageId,
                content: newMessage
            };

            chatAgent.editMessage(editChatParams, function (result) {
                console.log(result);
            });
        }

        function deleteMessage(messageId, deleteForAll) {
            if (typeof deleteForAll == "undefined") {
                deleteForAll = false;
            }

            chatAgent.deleteMessage({
                messageId: messageId,
                deleteForAll: deleteForAll
            }, function (result) {
                console.log(result);
            });
        }

        function replyMessage(threadId, messageId, message) {
            replyChatParams = {
                threadId: threadId,
                repliedTo: messageId,
                content: message,
                systemMetadata: {id: 1, name: "Masoud"},
                metadata: {id: 2, name: "Pooria"}
            };

            chatAgent.replyTextMessage(replyChatParams, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent! (Reply)");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered! (Reply)");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen! (Reply)");
                }
            });
        }

        function forwardMessage(destination, messageIds) {

            chatAgent.forwardMessage({
                threadId: destination,
                messageIds: messageIds
            }, {
                onSent: function (result) {
                    console.log(result.uniqueId + "has been Sent! (FORWARD)");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + "has been Delivered! (FORWARD)");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + "has been Seen! (FORWARD)");
                }
            });
        }

        function createThread(invitees, threadType) {
            if (typeof threadType == "string") {
                threadTypeText = threadType;
            } else {
                threadTypeText = "NORMAL";
            }

            createThreadParams = {
                title: "Thread Title Sample",
                type: threadTypeText,
                invitees: [],
                message: {
                    uniqueId: "9766b140-24a9-49fb-a02e-6aff70we5a6",
                    text: "This is a new Mesage",
                    metadata: {
                        messageTime: new Date()
                    },
                    systemMetadata: {
                        id: new Date().getTime()
                    },
                    type: 1
                    // forwardedMessageIds: [19633, 19632, 19631]
                }
            };

            if (Array.isArray(invitees)) {
                for (var i = 0; i < invitees.length; i++) {
                    invitee = formatDataToMakeInvitee({
                        id: invitees[i].id,
                        type: invitees[i].type
                    });
                    if (invitee) {
                        createThreadParams.invitees.push(invitee);
                    }
                }
            } else {
                invitee = formatDataToMakeInvitee({
                    id: invitees.id,
                    type: invitees.type
                });
                if (invitee) {
                    createThreadParams.invitees.push(invitee);
                }
            }

            chatAgent.createThread(createThreadParams, function (createThreadResult) {
                console.log(createThreadResult);
            });
        }

        function renameThread(threadId, newName) {
            renameThreadParams = {
                title: newName,
                threadId: threadId
            };

            chatAgent.renameThread(renameThreadParams, function (renameThreadResult) {
                console.log(renameThreadResult);
            });
        }

        function muteThread(threadId) {
            var data = {
                subjectId: threadId
            }
            chatAgent.muteThread(data, function (result) {
                if (!result.hasError) {
                    console.log("Threaded has been successfully muted!");
                }
                console.log(result);
            });
        }

        function blockContact(contactId) {
            var data = {
                contactId: contactId
            }
            chatAgent.block(data, function (result) {
                if (!result.hasError) {
                    console.log("Contact has been successfully Blocked!");
                }
                console.log(result);
            });
        }

        function unblockContact(blockId) {
            var data = {
                blockId: blockId
            }
            chatAgent.unblock(data, function (result) {
                if (!result.hasError) {
                    console.log("Contact has been successfully unBlocked!");
                }
                console.log(result);
            });
        }

        function getBlockedList() {
            var data = {
                count: 50,
                offset: 0
            }
            chatAgent.getBlockedList(data, function (result) {
                if (!result.hasError) {
                    console.log(result);
                }
            });
        }

        function unMuteThread(threadId) {
            var data = {
                subjectId: threadId
            }
            chatAgent.unMuteThread(data, function (result) {
                if (!result.hasError)
                    console.log("Threaded has been successfully unMuted!");
                console.log(result);
            });
        }

        function formatDataToMakeInvitee(messageContent) {
            var inviteeData = {
                id: messageContent.id,
                idType: messageContent.type
            };

            return inviteeData;
        }

        function uploadImage(image, xC, yC, hC, wC) {
            chatAgent.uploadImage({
                image: image,
                xC: xC,
                yC: yC,
                hC: hC,
                wC: wC
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    var image = result.result;
                    console.log("Image has been Successfully Uploaded => \n\n", image);
                }
            });
        }

        function getImage(imageId, hashCode) {
            chatAgent.getImage({
                imageId: imageId,
                hashCode: hashCode
            }, function (result) {
                if (!result.hasError) {
                    console.log("Image has been successfully received => \n", result.result);
                }
            });
        }

        function uploadFile(file) {
            chatAgent.uploadFile({
                file: file
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    var file = result.result;
                    console.log("File has been Successfully Uploaded => \n", file);
                }
            });
        }

        function getFile(fileId, hashCode, downloadable) {
            chatAgent.getFile({
                fileId: fileId,
                hashCode: hashCode,
                downloadable: downloadable
            }, function (result) {
                if (!result.hasError) {
                    console.log("File has been successfully received => \n", result.result);
                }
            });
        }

        function removeContacts(id) {
            chatAgent.removeContacts({
                id: id
            }, function (result) {
                console.log(result);
            });
        }
    </script>

    <style>
        html {
            font-family: monospace;
        }

        .btn {
            padding: 5px 15px;
            color: #fff;
            background-color: #222;
            border: none !important;
            text-decoration: none;
            margin: 5px 10px;
            display: inline-block;
        }

        input {
            padding: 5px 15px;
            border: solid 1px #ddd !important;
            margin: 5px 10px;
            display: inline-block;
        }

        #reconnect,
        #clearCache,
        #deleteCache {
            display: inline-block;
            font-size: 12px;
            color: #aaa;
            margin-left: 10px;
            cursor: pointer;
        }

        table td {
            border: solid 1px #ddd;
            padding: 6px 10px;
        }

        table tr:nth-child(2n) {
            background-color: #eee;
            font-family: monospace;
        }

        .video-wrapper {
            width: 44%;
            float: left;
            text-align: center;
        }

        .video-wrapper video {
            max-width: 100%;
            background-color: bisque;
        }
    </style>
</head>

<body style="max-width: 600px;">
<p>POD CHAT <span id="reconnect">Reconnect...</span> | <span id="clearCache">Clear User Cache</span> | <span
        id="deleteCache">Delete Cache</span></p>
Token: <input type="text" id="tokenInput" autocomplete="on" width="500">
<button id="tokenInputSet" class="btn">Set Token</button>
<br>
Thread: <input type="text" id="threadInput" autocomplete="on" width="500">
<button id="threadInputSet" class="btn">Set Thread</button>
<br>
<form>
    <fieldset>
        <legend>Call</legend>
        <label for="call-p2p-thread">Call P2P Thread Id : </label>
        <input type="text" name="call-p2p-thread" id="call-p2p-thread" value="4441" class="custom-thread-id">

        <a class="btn" href="#" onclick="chatAgent.startCall({
            threadId: document.getElementById('call-p2p-thread').value,
            type: 'video'
        })">Make Call</a>
        <br>
        <br>

        <fieldset>
            <legend>Started Call Info</legend>
            <table>
                <tr>
                    <td>Call Id</td>
                    <td>Broker</td>
                    <td>Send Topic</td>
                    <td>Receive Topic</td>
                    <td>Send Key</td>
                </tr>
                <tr>
                    <td id="call-receive-id"></td>
                    <td id="call-receive-broker"></td>
                    <td id="call-receive-send"></td>
                    <td id="call-receive-receive"></td>
                    <td id="call-receive-key"></td>
                </tr>
            </table>
        </fieldset>

        <br>

        <fieldset class="video-wrapper">
            <legend>Local stream</legend>

            <video id="uiLocalVideo"
                   width="320px"
                   height="240px"
                   playsinline
                   muted></video>
        </fieldset>

        <fieldset class="video-wrapper">
            <legend>Remote Stream</legend>

            <video id="uiRemoteVideo"
                   width="320px"
                   height="240px"
                   playsinline></video>
        </fieldset>
    </fieldset>
</form>


<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>General Functionalities</legend>
        <label for="g-p2p">P2P Thread Id : </label>
        <input type="text" name="p2p" id="g-p2p" value="35945" class="custom-thread-id">
        <label for="g-p2p-off">offset: </label>
        <input type="text" name="p2poff" id="g-p2p-off" value="0" size="2">
        <label for="g-p2p-count">Count: </label>
        <input type="text" name="p2pcount" id="g-p2p-count" value="10" size="2">
        <br>
        <a class="btn" href="#" onclick="getContacts({
            count:document.getElementById('g-p2p-count').value,
            offset: document.getElementById('g-p2p-off').value
        })">Get Contacts</a>
        <a class="btn" href="#" onclick="getThreads({
            count:document.getElementById('g-p2p-count').value,
            offset: document.getElementById('g-p2p-off').value
        })">Get Threads</a>
        <a class="btn" href="#" onclick="getHistory({
//            fromTimeFull: 1557830885624256000,
//            toTimeFull: 1558247572310448000,
            count:document.getElementById('g-p2p-count').value,
            offset: document.getElementById('g-p2p-off').value,
            threadId: document.getElementById('g-p2p').value});">Get History</a>
        <a class="btn" href="#" onclick="getThreadParticipants(document.getElementById('g-p2p').value)">Get Thread
            Participants</a>
        <a class="btn" href="#" onclick="chatAgent.getThreadAdmins({threadId:document.getElementById('g-p2p').value}, function(res){
            console.log(res);
        })">Get Thread Admins</a>
        <a class="btn" href="#" onclick="leaveThread(document.getElementById('g-p2p').value)">Leave Thread</a>
        <br>
        <br>
    </fieldset>
</form>


<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Create Thread</legend>
        <label for="createThreadTitle">Thread title</label>
        <input type="text" name="createThreadTitle" id="createThreadTitle" value="Thread Title">

        <label for="createThreadPublicName">Thread Public Name</label>
        <input type="text" name="createThreadPublicName" id="createThreadPublicName" value="TPN">

        <label for="createThreadType">Thread Type</label>
        <select name="createThreadType" id="createThreadType">
            <option value="NORMAL">NORMAL</option>
            <option value="OWNER_GROUP">OWNER_GROUP</option>
            <option value="PUBLIC_GROUP">PUBLIC_GROUP</option>
            <option value="CHANNEL_GROUP">CHANNEL_GROUP</option>
            <option value="CHANNEL">CHANNEL</option>
        </select>
        <br>


        <label for="createThreadImage">Thread img</label>
        <input type="text" name="createThreadImage" id="createThreadImage" value="">

        <label for="createThreadDesc">Thread Desc</label>
        <input type="text" name="createThreadDesc" id="createThreadDesc" value="Thread Description">

        <br>

        <label for="createThreadMetadata">Thread Metadata (JSON)</label>
        <textarea name="createThreadMetadata" id="createThreadMetadata" rows="4" cols="70"></textarea>

        <br>

        <label for="createThreadInvitees">Thread Invitees (JSON Array)</label>
        <textarea name="createThreadInvitees" id="createThreadInvitees" rows="10" cols="70">
[{
  "id": 122,
  "type": "TO_BE_USER_CONTACT_ID"
}, {
  "id": 1102,
  "type": "TO_BE_USER_CONTACT_ID"
}]
      </textarea>

        <button type="button" name="button" id="createThreadButton">Create Thread</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Create Thread With File Message</legend>
        <label for="createThreadWithFileFile">File : </label>
        <input type="file" name="createThreadWithFileFile" id="createThreadWithFileFile">
        <br>

        <label for="createThreadWithFileTitle">Thread title</label>
        <input type="text" name="createThreadWithFileTitle" id="createThreadWithFileTitle" value="Thread Title">
        <br>

        <label for="createThreadWithFileType">Thread Type</label>
        <select name="createThreadWithFileType" id="createThreadWithFileType">
            <option value="NORMAL">NORMAL</option>
            <option value="OWNER_GROUP">OWNER_GROUP</option>
            <option value="PUBLIC_GROUP">PUBLIC_GROUP</option>
            <option value="CHANNEL_GROUP">CHANNEL_GROUP</option>
            <option value="CHANNEL">CHANNEL</option>
        </select>
        <br>

        <label for="createThreadWithMessageType">Message Type</label>
        <select name="createThreadWithMessageType" id="createThreadWithMessageType">
            <option value="TEXT">TEXT</option>
            <option value="POD_SPACE_PICTURE">POD_SPACE_PICTURE</option>
            <option value="POD_SPACE_VIDEO">POD_SPACE_VIDEO</option>
            <option value="POD_SPACE_SOUND">POD_SPACE_SOUND</option>
            <option value="POD_SPACE_VOICE">POD_SPACE_VOICE</option>
            <option value="POD_SPACE_FILE">POD_SPACE_FILE</option>
            <option value="LINK">LINK</option>
            <option value="STICKER">STICKER</option>
        </select>
        <br>

        <label for="createThreadWithFileDesc">Thread Desc</label>
        <input type="text" name="createThreadWithFileDesc" id="createThreadWithFileDesc" value="Thread Description">

        <br>

        <label for="createThreadWithFileCaption">FileMessage caption</label>
        <input type="text" name="createThreadWithFileCaption" id="createThreadWithFileCaption" value="Caption">

        <br>

        <label for="createThreadWithFileMetadata">Thread Metadata (JSON)</label>
        <textarea name="createThreadWithFileMetadata" id="createThreadWithFileMetadata" rows="4" cols="70"></textarea>

        <br>

        <label for="createThreadWithFileInvitees">Thread Invitees (JSON Array)</label>
        <textarea name="createThreadWithFileInvitees" id="createThreadWithFileInvitees" rows="7" cols="70">
[{
  "id": 122,
  "type": "TO_BE_USER_CONTACT_ID"
}, {
  "id": 1102,
  "type": "TO_BE_USER_CONTACT_ID"
}]
      </textarea>

        <button type="button" name="button" id="createThreadWithFileButton">Create Thread</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Add Participant to Thread</legend>
        <label for="apThread">Thread Id</label>
        <input type="text" name="apThread" id="apThread" class="custom-thread-id">
        <br>
        <label for="apList">Participants (Array of IDs):</label>
        <input type="text" name="apList" id="apList" placeholder="1, 2, 3, ...">
        <button type="button" name="button" id="apButton">Add Participants</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Send Text Message</legend>
        <label for="sendTextThread">Thread Id</label>
        <input type="text" name="sendTextThread" id="sendTextThread" class="custom-thread-id">
        <br>
        <label for="sendTextMessage">Message :</label>
        <textarea type="text" name="sendTextMessage" id="sendTextMessage"></textarea>
        <button type="button" name="button" id="sendTextButton">Send Text Message</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Resend Message by UniqueId</legend>
        <label for="resendUid">Unique Id</label>
        <input type="text" name="resendUid" id="resendUid">
        <br>
        <button type="button" name="button" id="resendButton">Resend Message</button>
        <button type="button" name="button" id="cancelButton">Cancel Message</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Send File Message</legend>
        <label for="sendFileThread">Thread Id</label>
        <input type="text" name="sendFileThread" id="sendFileThread" value="54436" class="custom-thread-id">
        <br>
        <label for="sendFileUserGroupHash">Thread userGroupHash</label>
        <input type="text" name="sendFileUserGroupHash" id="sendFileUserGroupHash" value="5GW93QH695O7HC">
        <br>

        <label for="sendFileMessageType">Message Type</label>
        <select name="sendFileMessageType" id="sendFileMessageType">
            <option value="TEXT">TEXT</option>
            <option value="POD_SPACE_PICTURE">POD_SPACE_PICTURE</option>
            <option value="POD_SPACE_VIDEO">POD_SPACE_VIDEO</option>
            <option value="POD_SPACE_SOUND">POD_SPACE_SOUND</option>
            <option value="POD_SPACE_VOICE">POD_SPACE_VOICE</option>
            <option value="POD_SPACE_FILE">POD_SPACE_FILE</option>
            <option value="LINK">LINK</option>
            <option value="STICKER">STICKER</option>
        </select>
        <br>

        <input type="file" name="sendFileInput" id="sendFileInput">
        <br>
        <label for="sendFileDescription">Description: </label>
        <textarea type="text" name="sendFileDescription" id="sendFileDescription"></textarea>
        <button type="button" name="button" id="sendFileMessage">Send File Message</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Reply File Message</legend>
        <label for="sendFileThreadReply">Thread Id</label>
        <input type="text" name="sendFileThread" id="sendFileThreadReply" value="" class="custom-thread-id">
        <br>
        <label for="sendFileMesageRepliedTo">Message Id</label>
        <input type="text" name="sendFileThread" id="sendFileMesageRepliedTo" value="">
        <br>
        <label for="sendFileUserGroupHashReply">Thread userGroupHash</label>
        <input type="text" name="sendFileUserGroupHash" id="sendFileUserGroupHashReply" value="">
        <br>

        <label for="sendFileMessageTypeReply">Message Type</label>
        <select name="sendFileMessageType" id="sendFileMessageTypeReply">
            <option value="TEXT">TEXT</option>
            <option value="POD_SPACE_PICTURE">POD_SPACE_PICTURE</option>
            <option value="POD_SPACE_VIDEO">POD_SPACE_VIDEO</option>
            <option value="POD_SPACE_SOUND">POD_SPACE_SOUND</option>
            <option value="POD_SPACE_VOICE">POD_SPACE_VOICE</option>
            <option value="POD_SPACE_FILE">POD_SPACE_FILE</option>
            <option value="LINK">LINK</option>
        </select>
        <br>

        <input type="file" name="sendFileInput" id="sendFileInputReply">
        <br>
        <label for="sendFileDescriptionReply">Description: </label>
        <textarea type="text" name="sendFileDescription" id="sendFileDescriptionReply"></textarea>
        <button type="button" name="button" id="sendFileMessageReply">Reply File Message</button>
    </fieldset>
</form>

<br>
<hr>
<br>


<form>
    <fieldset>
        <legend>Update Thread Info</legend>
        <label for="updateThreadThreadId">Thread Id</label>
        <input type="text" name="updateThreadThreadId" id="updateThreadThreadId" value="" class="custom-thread-id">
        <br>
        <label for="updateThreadUserGroupHash">Thread User Group Hash</label>
        <input type="text" name="updateThreadUserGroupHash" id="updateThreadUserGroupHash" value="">
        <br>
        <input type="file" name="updateThreadFile" id="updateThreadFile">
        <br>
        <label for="updateThreadTitle">Title: </label>
        <input type="text" name="updateThreadTitle" id="updateThreadTitle" value="New Title">
        <br>
        <label for="updateThreadDescription">Description: </label>
        <textarea type="text" name="updateThreadDescription" id="updateThreadDescription"></textarea>
        <br>
        <label for="updateThreadMetadata">Metadata: </label>
        <textarea type="text" name="updateThreadMetadata" id="updateThreadMetadata"></textarea>

        <button type="button" name="button" id="updateThreadInfo">Update</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Upload Image</legend>
        <input type="file" name="image" id="imageInput" value="">
        <button type="button" name="button" id="uploadImage">Upload Image</button>
        <br>
        <img id="uploadedImage"/>
        <div id="uploadedImageData"></div>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Upload File</legend>
        <input type="file" name="file" id="fileInput" value="">
        <button type="button" name="button" id="uploadFile">Upload File</button>
        <br>
        <div id="uploadedFile"></div>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Get Image</legend>
        <label for="imageId">Image ID : </label>
        <input type="text" name="imageId" id="imageId" value="">
        <br>
        <label for="hashCode">HashCode:</label>
        <input type="text" name="hashCode" id="hashCode" value="">
        <button type="button" name="button" id="getImage">Get Image</button>
        <br>
        <img id="getImageResult"/>
    </fieldset>
</form>

<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Get File</legend>
        <label for="fileId">File ID : </label>
        <input type="text" name="fileId" id="fileId" value="">
        <br>
        <label for="fileHashCode">HashCode:</label>
        <input type="text" name="fileHashCode" id="fileHashCode" value="">
        <button type="button" name="button" id="getFile">Get File</button>
        <br>
        <div id="getFileResult"></div>
    </fieldset>
</form>


<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Get File From Podspace</legend>
        <label for="fileHash">HashCode:</label>
        <input type="text" name="fileHash" id="fileHash" value="">
        <button type="button" name="button" id="getFileFromPodspace">Get File</button>

        <label for="fileResponseType">Response Type</label>
        <select name="fileResponseType" id="fileResponseType">
            <option value="link">link</option>
            <option value="blob">blob</option>
        </select>
        <br>
        <div id="getFileFromPodspaceResult"></div>
    </fieldset>
</form>


<br>
<hr>
<br>

<form>
    <fieldset>
        <legend>Get Image From Podspace</legend>
        <label for="imageHash">HashCode:</label>
        <input type="text" name="imageHash" id="imageHash" value=""><br>
        <label for="imageSize">Image Size:</label>
        <input type="text" name="imageSize" id="imageSize" value="3"><br>
        <label for="imageQuality">Image Quality:</label>
        <input type="text" name="imageQuality" id="imageQuality" value="1"><br>
        <label for="imageCrop">Crop:</label>
        <input type="checkbox" name="imageCrop" id="imageCrop"><br>

        <label for="imageResponseType">Response Type</label>
        <select name="imageResponseType" id="imageResponseType">
            <option value="link">link</option>
            <option value="blob">blob</option>
            <option value="base64" selected>base64</option>
        </select>

        <button type="button" name="button" id="getImageFromPodspace">Get Image</button>
        <br>
        <div id="getImageFromPodspaceResult"></div>
    </fieldset>
</form>


<br>
<hr>
<br>

<form method="POST" action="https://sandbox.pod.ir:8043/srv/basic-platform/nzh/addContacts">
    <fieldset>
        <legend>Add Contact</legend>
        <label for="firstNameAdd">firstName : </label>
        <input type="text" name="firstName" id="firstNameAdd" value="">
        <br>
        <label for="lastNameAdd">lastName : </label>
        <input type="text" name="lastName" id="lastNameAdd" value="">
        <br>
        <label for="cellphoneNumberAdd">cellphoneNumber : </label>
        <input type="text" name="cellphoneNumber" id="cellphoneNumberAdd" value="">
        <br>
        <label for="emailAdd">email : </label>
        <input type="text" name="email" id="emailAdd" value="">
        <br>
        <label for="_token_">Token : </label>
        <input type="text" name="_token_">
        <br>
        <label for="uniqueId">uniqueId : </label>
        <input type="text" name="uniqueId">
        <br>

        <input type="hidden" name="_token_issuer_" value="1">
        <button type="submit">Add Contact</button>
    </fieldset>
</form>


<br>
<hr>

<form method="POST" action="http://172.16.110.131:8080/nzh/updateContacts">
    <fieldset>
        <legend>Update Contact</legend>
        <label for="id">id : </label>
        <input type="text" name="id" id="id" value="">
        <br>
        <label for="firstName">firstName : </label>
        <input type="text" name="firstName" id="firstName" value="">
        <br>
        <label for="lastName">lastName : </label>
        <input type="text" name="lastName" id="lastName" value="">
        <br>
        <label for="cellphoneNumber">cellphoneNumber : </label>
        <input type="text" name="cellphoneNumber" id="cellphoneNumber" value="">
        <br>
        <label for="email">email : </label>
        <input type="text" name="email" id="email" value="">
        <br>
        <label for="_token_">Token : </label>
        <input type="text" name="_token_">
        <br>
        <label for="uniqueId">uniqueId : </label>
        <input type="text" name="uniqueId">
        <br>

        <input type="hidden" name="_token_issuer_" value="1">
        <button type="submit">Update Contact</button>
    </fieldset>
</form>

<br>
<hr>
<br>

<form action="">
    <fieldset>
        <legend>Remove Contact</legend>
        <label for="contact_id">id : </label>
        <input type="text" name="contact_id" id="contact_id" value="">
        <br>
        <label for="_token_">Token : </label>
        <input type="text" name="_token_">
        <br>
        <input type="hidden" name="_token_issuer_" value="1">
        <button type="button" onclick="removeContacts(document.getElementById('contact_id').value)">Remove Contact
        </button>
    </fieldset>
</form>

</body>

<script>
    document.getElementById("reconnect")
        .addEventListener("click", function () {
            chatAgent.reconnect();
        });

    document.getElementById("clearCache")
        .addEventListener("click", function () {
            chatAgent.clearCacheDatabasesOfUser();
        });

    document.getElementById("deleteCache")
        .addEventListener("click", function () {
            chatAgent.deleteCacheDatabases({
                storage: true,
                queues: true
            });
        });

    /**
     * CREATE THREAD
     */
    document.getElementById("createThreadButton")
        .addEventListener("click", function () {
            var invitees = JSON.parse(document.getElementById("createThreadInvitees").value);

            createThreadParams = {
                title: document.getElementById("createThreadTitle").value,
                type: document.getElementById("createThreadType").value,
                invitees: [],
                image: document.getElementById("createThreadImage").value,
                description: document.getElementById("createThreadDesc").value,
                metadata: document.getElementById("createThreadMetadata").value,
                uniqueName: document.getElementById("createThreadPublicName").value
            };

            if (Array.isArray(invitees)) {
                for (var i = 0; i < invitees.length; i++) {
                    invitee = formatDataToMakeInvitee({
                        id: invitees[i].id,
                        type: invitees[i].type
                    });
                    if (invitee) {
                        createThreadParams.invitees.push(invitee);
                    }
                }
            } else {
                invitee = formatDataToMakeInvitee({
                    id: invitees.id,
                    type: invitees.type
                });
                if (invitee) {
                    createThreadParams.invitees.push(invitee);
                }
            }

            chatAgent.createThread(createThreadParams, function (createThreadResult) {
                console.log(createThreadResult);
            });
        });


    /**
     * CREATE THREAD WITH FILE
     */
    document.getElementById("createThreadWithFileButton")
        .addEventListener("click", function () {
            var invitees = JSON.parse(document.getElementById("createThreadWithFileInvitees").value),
                fileInput = document.getElementById("createThreadWithFileFile"),
                image = fileInput.files[0];

            createThreadParams = {
                title: document.getElementById("createThreadWithFileTitle").value,
                type: document.getElementById("createThreadWithFileType").value,
                messageType: document.getElementById("createThreadWithMessageType").value,
                invitees: [],
                description: document.getElementById("createThreadWithFileDesc").value,
                caption: document.getElementById("createThreadWithFileCaption").value,
                metadata: document.getElementById("createThreadWithFileMetadata").value,
                file: image
            };

            if (Array.isArray(invitees)) {
                for (var i = 0; i < invitees.length; i++) {
                    invitee = formatDataToMakeInvitee({
                        id: invitees[i].id,
                        type: invitees[i].type
                    });
                    if (invitee) {
                        createThreadParams.invitees.push(invitee);
                    }
                }
            } else {
                invitee = formatDataToMakeInvitee({
                    id: invitees.id,
                    type: invitees.type
                });
                if (invitee) {
                    createThreadParams.invitees.push(invitee);
                }
            }

            chatAgent.createThreadWithFileMessage(createThreadParams, function (createThreadResult) {
                console.log(createThreadResult);
            }, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                }
            });
        });

    /**
     * SEND FILE
     */
    document.getElementById("sendTextButton")
        .addEventListener("click", function () {
            var message = document.getElementById("sendTextMessage").value,
                thread = document.getElementById("sendTextThread").value;

            var instantResult = chatAgent.sendTextMessage({
                threadId: thread,
                textMessage: message,
                messageType: 'TEXT'
            }, {
                onSent: function (result) {
                    console.log({result});
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                }
            });
        });

    /**
     * ADD PARTICIPANTS
     */
    document.getElementById("apButton")
        .addEventListener("click", function () {
            var participants = document.getElementById("apList")
                    .value
                    .split(","),
                thread = document.getElementById("apThread").value;

            chatAgent.addParticipants({
                threadId: thread,
                contacts: participants
            }, function (result) {
                console.log(result);
            });
        });

    /**
     * Resend Message
     */
    document.getElementById("resendButton")
        .addEventListener("click", function () {
            var uniqueId = document.getElementById("resendUid").value;

            chatAgent.resendMessage(uniqueId);
        });

    /**
     * Cancel Message
     */
    document.getElementById("cancelButton")
        .addEventListener("click", function () {
            var uniqueId = document.getElementById("resendUid").value;

            chatAgent.cancelMessage(uniqueId, function () {
                console.log("Message has been canceled");
            });
        });

    /**
     * SEND FILE
     */
    document.getElementById("sendFileMessage")
        .addEventListener("click", function () {
            var fileInput = document.getElementById("sendFileInput"),
                image = fileInput.files[0],
                content = document.getElementById("sendFileDescription").value,
                thread = document.getElementById("sendFileThread").value,
                messageType = document.getElementById("sendFileMessageType").value,
                userGroupHash = document.getElementById("sendFileUserGroupHash").value;

            var instantResult = chatAgent.sendFileMessage({
                threadId: thread,
                file: image,
                content: content,
                userGroupHash: userGroupHash,
                messageType: messageType,
                metadata: {
                    custom_name: "John Doe"
                }
            }, {
                onSent: function (result) {
                    console.log(result);
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                },
                onFileUpload: function (result) {
                    console.log('File Upload is done', result);
                }
            });

            console.log("Instant sendFile Results", instantResult)

            // console.log("Should cancel file upload after 100ms. (uid = " + instantResult.content.file.uniqueId + ")")
            // setTimeout(() => {
            //   chatAgent.cancelFileUpload({
            //     uniqueId: instantResult.content.file.uniqueId
            //   }, function() {
            //     console.log("Upload has been Canceled!");
            //   });
            // }, 100);
        });


    /**
     * REPLY FILE MESSAGE
     */
    document.getElementById("sendFileMessageReply")
        .addEventListener("click", function () {
            var fileInput = document.getElementById("sendFileInputReply"),
                image = fileInput.files[0],
                content = document.getElementById("sendFileDescriptionReply").value,
                thread = document.getElementById("sendFileThreadReply").value,
                repliedTo = document.getElementById("sendFileMesageRepliedTo").value,
                messageType = document.getElementById("sendFileMessageTypeReply").value,
                userGroupHash = document.getElementById("sendFileUserGroupHashReply").value;

            var instantResult = chatAgent.replyFileMessage({
                threadId: thread,
                repliedTo: repliedTo,
                file: image,
                content: content,
                userGroupHash: userGroupHash,
                messageType: messageType,
                metadata: {
                    custom_name: "John Doe"
                }
            }, {
                onSent: function (result) {
                    console.log(result.uniqueId + " \t has been Sent!");
                },
                onDeliver: function (result) {
                    console.log(result.uniqueId + " \t has been Delivered!");
                },
                onSeen: function (result) {
                    console.log(result.uniqueId + " \t has been Seen!");
                }
            });

            console.log("Instant Reply File Message Results", instantResult);
        });

    /**
     * Update Threaf Info
     */
    document.getElementById("updateThreadInfo")
        .addEventListener("click", function () {
            var fileInput = document.getElementById("updateThreadFile"),
                image = fileInput.files[0],
                title = document.getElementById("updateThreadTitle").value,
                description = document.getElementById("updateThreadDescription").value,
                metadata = document.getElementById("updateThreadMetadata").value,
                thread = document.getElementById("updateThreadThreadId").value,
                userGroupHash = document.getElementById("updateThreadUserGroupHash").value;

            var instantResult = chatAgent.updateThreadInfo({
                threadId: thread,
                userGroupHash: userGroupHash,
                image: image,
                description: description,
                title: title,
                metadata: metadata,
                messageType: 'POD_SPACE_PICTURE'
            }, function (result) {
                console.log(result);
            });

            //
            // console.log("Instant updateThreadInfo Results", instantResult)
        });

    /**
     * UPLOAD IMAGE
     */
    document.getElementById("uploadImage")
        .addEventListener("click", function () {
            var imageInput = document.getElementById("imageInput"),
                image = imageInput.files[0];

            var uploadResult = chatAgent.uploadImage({
                image: image,
                // fileName: "Test Name",
                xC: 100,
                yC: 100,
                hC: 800,
                wC: 800
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    var image = result.result;

                    chatAgent.getImage({
                        imageId: image.id,
                        hashCode: image.hashCode
                    }, function (result) {
                        if (!result.hasError) {
                            document.getElementById("uploadedImage").src = result.result;
                            document.getElementById("uploadedImageData").innerHTML =
                                "<pre><br>Uploaded Image Id: " +
                                image.id + "<br>Uploaded Image Name : " + image.name +
                                "<br>Uploaded Image HashCode : " +
                                image.hashCode + "</pre>";
                        }
                    });
                }
            });

            console.log(uploadResult);
        });

    /**
     * UPLOAD FILE
     */
    document.getElementById("uploadFile")
        .addEventListener("click", function () {
            var fileInput = document.getElementById("fileInput"),
                file = fileInput.files[0];

            var uploadResult = chatAgent.uploadFile({
                file: file,
                // fileName: "Test Name"
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    var file = result.result;
                    document.getElementById("uploadedFile").innerHTML = "<pre><br>Uploaded File Id: " + file
                            .id +
                        "<br>Uploaded File Name : " + file.name + "<br>Uploaded File HashCode : " + file
                            .hashCode +
                        "</pre>";
                }
            });

            console.log(uploadResult);
        });

    /**
     * GET IMAGE
     */
    document.getElementById("getImage")
        .addEventListener("click", function () {
            var imageId = document.getElementById("imageId").value,
                hashCode = document.getElementById("hashCode").value;

            chatAgent.getImage({
                imageId: imageId,
                hashCode: hashCode
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    document.getElementById("getImageResult").src = result.result;
                }
            });
        });

    /**
     * GET FILE
     */
    document.getElementById("getFile")
        .addEventListener("click", function () {
            var fileId = document.getElementById("fileId").value,
                hashCode = document.getElementById("fileHashCode").value;

            chatAgent.getFile({
                fileId: fileId,
                hashCode: hashCode,
                downloadable: true
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    document.getElementById("getFileResult").innerHTML = "<a href=\"" + result.result +
                        "\">" +
                        result.result + "</a>";
                }
            });
        });

    document.getElementById("getFileFromPodspace")
        .addEventListener("click", function () {
            var hashCode = document.getElementById("fileHash").value;

            chatAgent.getFileFromPodspace({
                hashCode: 'qef78wse80vs587wserfwv',
                responseType: 'link'
            }, function (result) {
                console.log(result);
                if (!result.hasError) {
                    if (result.type == 'link') {
                        var fileOutput = document.createElement('a');
                        fileOutput.href = result.result;
                        fileOutput.innerText = result.result;
                        document.getElementById('getFileFromPodspaceResult').appendChild(fileOutput);
                    } else {
                        if (result.result.type.match(/image/g)) {
                            var reader = new FileReader();

                            reader.onloadend = function () {
                                var image = new Image;
                                image.src = reader.result;
                                var fileOutput = document.createElement('a');
                                fileOutput.href = reader.result;
                                fileOutput.download = 'image.jpg';
                                fileOutput.appendChild(image);
                                document.getElementById('getFileFromPodspaceResult').appendChild(fileOutput);
                            };

                            reader.readAsDataURL(result.result);
                        } else {
                            var fileUrl = URL.createObjectURL(result.result);
                            var fileOutput = document.createElement('a');
                            fileOutput.addEventListener('load', function () {
                                URL.revokeObjectURL(fileUrl)
                            });
                            fileOutput.innerText = 'Download File';
                            fileOutput.href = fileUrl;
                            fileOutput.download = 'Darkthrone.svg';
                            document.getElementById('getFileFromPodspaceResult').appendChild(fileOutput);
                        }
                    }
                }
            });


        });

    document.getElementById("getImageFromPodspace")
        .addEventListener("click", function () {
            chatAgent.getImageFromPodspace({
                hashCode: document.getElementById("imageHash").value,
                size: document.getElementById("imageSize").value,
                quality: document.getElementById("imageQuality").value,
                crop: document.getElementById("imageCrop").checked,
                responseType: document.getElementById('imageResponseType').value
            }, function (result) {
                console.log(result)
                if (!result.hasError) {
                    switch (result.type) {
                        case 'link':
                            var output = document.createElement('img');
                            output.src = result.result;
                            document.getElementById('getImageFromPodspaceResult').appendChild(output);
                            break;

                        case 'base64':
                            // var reader = new FileReader();
                            // reader.onloadend = function () {
                            //     console.log('read as dataturl', reader.result);
                            //     document.getElementById('getImageFromPodspaceResult').innerHTML = `<img src="${reader.result}" >`;
                            //     reader = null;
                            // };
                            // reader.readAsDataURL(result.result);

                            // Base64 Model
                            console.log('Base 64 from SDK', result.result);
                            document.getElementById('getImageFromPodspaceResult').innerHTML = `<img src="${result.result}" >`;
                            break;

                        case 'blob':
                        default:
                            var reader = new FileReader();

                            reader.onloadend = function () {
                                var image = new Image;
                                image.src = reader.result;
                                var fileOutput = document.createElement('a');
                                fileOutput.href = reader.result;
                                fileOutput.download = 'image.jpg';
                                fileOutput.appendChild(image);
                                document.getElementById('getImageFromPodspaceResult').appendChild(fileOutput);
                            };

                            reader.readAsDataURL(result.result);
                            break;
                    }
                }
            });
        });

    document.getElementById('tokenInputSet').addEventListener('click', function (e) {
        console.log('New Token Has been set: ', document.getElementById('tokenInput').value);
        chatAgent.setToken(document.getElementById('tokenInput').value);
    });

    document.getElementById('threadInputSet').addEventListener('click', function (e) {
        console.log('New Thread Has been set: ', document.getElementById('threadInput').value);
        var items = document.getElementsByClassName('custom-thread-id');
        for (var i = 0; i < items.length; i++) {
            items[i].value = document.getElementById('threadInput').value;
        }
    });

</script>

</html>
